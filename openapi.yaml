openapi: 3.0.3
info:
  title: Apps-I Desa Backend API
  version: 1.0.0

servers:
  - url: http://localhost:3000
    description: Development server
  - url: https://be-apps-i-desa-production.up.railway.app/
    description: Production Server

security:
  - cookieAuth: []

components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: AppsIDesaCookie
      description: Cookie-based authentication

  schemas:
    MessageResponse:
      type: object
      properties:
        message:
          type: string
          description: Response message
          example: Operation successful
    # Auth DTOs
    LoginRequest:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          description: User's username
          example: admin
        password:
          type: string
          format: password
          description: User's password
          example: password123

    LoginResponse:
      type: object
      properties:
        token:
          type: string
          description: JWT token for authentication
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        message:
          type: string
          description: Response message
          example: Login successful

    # Villager DTOs
    AddVillagerRequest:
      type: object
      required:
        - nik
        - nama_lengkap
        - jenis_kelamin
        - tempat_lahir
        - tanggal_lahir
        - agama
        - pendidikan
        - pekerjaan
        - status_perkawinan
        - status_hubungan
        - kewarganegaraan
        - nama_ayah
        - nama_ibu
        - family_card_id
      properties:
        nik:
          type: string
          pattern: '^[0-9]{16}$'
          description: 16-digit National ID Number
          example: "3201234567890001"
        nama_lengkap:
          type: string
          description: Full name of villager
          example: John Doe
        jenis_kelamin:
          type: string
          description: Gender
          example: L
        tempat_lahir:
          type: string
          description: Place of birth
          example: Jakarta
        tanggal_lahir:
          type: string
          description: Date of birth
          example: "1990-01-15"
        agama:
          type: string
          description: Religion
          example: Islam
        pendidikan:
          type: string
          description: Education level
          example: S1
        pekerjaan:
          type: string
          description: Occupation
          example: PNS
        status_perkawinan:
          type: string
          description: Marital status
          example: Kawin
        status_hubungan:
          type: string
          description: Family relationship status
          example: Kepala Keluarga
        kewarganegaraan:
          type: string
          description: Citizenship
          example: WNI
        nomor_paspor:
          type: string
          nullable: true
          description: Passport number (optional)
          example: null
        nomor_kitas:
          type: string
          nullable: true
          description: KITAS number (optional)
          example: null
        nama_ayah:
          type: string
          description: Father's name
          example: John Sr.
        nama_ibu:
          type: string
          description: Mother's name
          example: Jane Doe
        family_card_id:
          type: string
          description: Family card ID
          example: "3201234567890001"

    UpdateVillagerRequest:
      type: object
      properties:
        nik:
          type: string
          pattern: '^[0-9]{16}$'
          description: 16-digit National ID Number (optional)
          nullable: true
          example: "3201234567890001"
        nama_lengkap:
          type: string
          description: Full name of villager (optional)
          nullable: true
          example: John Doe
        jenis_kelamin:
          type: string
          description: Gender (optional)
          nullable: true
          example: L
        tempat_lahir:
          type: string
          description: Place of birth (optional)
          nullable: true
          example: Jakarta
        tanggal_lahir:
          type: string
          description: Date of birth (optional)
          nullable: true
          example: "1990-01-15"
        agama:
          type: string
          description: Religion (optional)
          nullable: true
          example: Islam
        pendidikan:
          type: string
          description: Education level (optional)
          nullable: true
          example: S1
        pekerjaan:
          type: string
          description: Occupation (optional)
          nullable: true
          example: PNS
        status_perkawinan:
          type: string
          description: Marital status (optional)
          nullable: true
          example: Kawin
        status_hubungan:
          type: string
          description: Family relationship status (optional)
          nullable: true
          example: Kepala Keluarga
        kewarganegaraan:
          type: string
          description: Citizenship (optional)
          nullable: true
          example: WNI
        nomor_paspor:
          type: string
          description: Passport number (optional)
          nullable: true
          example: null
        nomor_kitas:
          type: string
          description: KITAS number
          nullable: true
          example: null
        nama_ayah:
          type: string
          description: Father's name
          nullable: true
          example: John Sr.
        nama_ibu:
          type: string
          description: Mother's name
          nullable: true
          example: Jane Doe

    DeleteVillagerRequest:
      type: object
      required:
        - nik
      properties:
        nik:
          type: string
          pattern: '^[0-9]{16}$'
          description: 16-digit National ID Number
          example: "3201234567890001"

    GetFamilyMember:
      type: object
      properties:
        name:
          type: string
          description: Full name
          example: John Doe
        status_hubungan:
          type: string
          description: Family relationship
          example: Kepala Keluarga
        age:
          type: integer
          description: Age in years
          example: 35
        jenis_kelamin:
          type: string
          description: Gender
          example: L
        pendidikan:
          type: string
          description: Education level
          example: S1
        pekerjaan:
          type: string
          description: Occupation
          example: PNS

    # Family Card DTOs
    AddFamilyCardRequest:
      type: object
      required:
        - nik
        - address
        - rt
        - rw
        - kelurahan
        - kecamatan
        - kabupaten_kota
        - kode_pos
        - provinsi
      properties:
        nik:
          type: string
          pattern: '^[0-9]{16}$'
          description: Family card number
          example: "3201234567890001"
        address:
          type: string
          description: Address
          example: "Jl. Merdeka No. 123"
        rt:
          type: string
          description: RT number
          example: "001"
        rw:
          type: string
          description: RW number
          example: "002"
        kelurahan:
          type: string
          description: Village/Kelurahan
          example: Sukamaju
        kecamatan:
          type: string
          description: Sub-district
          example: Kecamatan Tengah
        kabupaten_kota:
          type: string
          description: Regency/City
          example: Kabupaten Sukses
        kode_pos:
          type: string
          description: Postal code
          example: "12345"
        provinsi:
          type: string
          description: Province
          example: Jawa Barat

    GetAllFamilyCardsResponse:
      type: object
      properties:
        family_cards:
          type: array
          items:
            $ref: '#/components/schemas/GetFamilyCardResponse'

    GetFamilyCardResponse:
      type: object
      properties:
        nik:
          type: string
          description: Family card NIK
          example: "3201234567890001"
        name:
          type: string
          nullable: true
          description: Head of family name
          example: John Doe
        total_members:
          type: integer
          description: Total family members
          example: 4

    GetAllFamilyMember:
      type: object
      properties:
        nik:
          type: string
          description: Family card NIK
          example: "3201234567890001"
        address:
          type: string
          description: Family address
          example: "Jl. Merdeka No. 123"
        family_members:
          type: array
          items:
            $ref: '#/components/schemas/GetFamilyMember'

    # Village DTOs
    AddVillageRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: Village name
          example: Desa Sukamaju

    # User DTOs
    RegisterRequest:
      type: object
      required:
        - username
        - password
        - village_id
      properties:
        username:
          type: string
          description: Unique username
          example: admin
        password:
          type: string
          format: password
          description: User password
          example: password123
        village_id:
          type: string
          format: uuid
          description: Village UUID
          example: "550e8400-e29b-41d4-a716-446655440000"

    # Sub-Dimension DTOs
    AddSubDimensionPendidikanRequest:
      type: object
      required:
        - ketersediaan_paud
        - kemudahan_akses_paud
        - apm_paud
        - kemudahan_akses_sd
        - apm_sd
        - kemudahan_akses_smp
        - apm_smp
        - kemudahan_akses_sma
        - apm_sma
      properties:
        ketersediaan_paud:
          type: string
          description: Availability of early childhood education
          example: "Ada"
        kemudahan_akses_paud:
          type: string
          description: Ease of access to early childhood education
          example: "Mudah"
        apm_paud:
          type: string
          description: Gross enrollment rate for early childhood education
          example: "80%"
        kemudahan_akses_sd:
          type: string
          description: Ease of access to elementary school
          example: "Mudah"
        apm_sd:
          type: string
          description: Gross enrollment rate for elementary school
          example: "95%"
        kemudahan_akses_smp:
          type: string
          description: Ease of access to junior high school
          example: "Mudah"
        apm_smp:
          type: string
          description: Gross enrollment rate for junior high school
          example: "90%"
        kemudahan_akses_sma:
          type: string
          description: Ease of access to senior high school
          example: "Mudah"
        apm_sma:
          type: string
          description: Gross enrollment rate for senior high school
          example: "85%"
        year:
          type: integer
          minimum: 2000
          maximum: 2100
          description: Year of data
          example: 2024

    # Response DTOs
    SuccessResponse:
      type: object
      properties:
        status:
          type: string
          example: success
        message:
          type: string
          example: Operation completed successfully
        data:
          type: object
          description: Response data

    ErrorResponse:
      type: object
      properties:
        message:
          type: string
          example: An error occurred
        error:
          type: string
          description: Error details

    ValidationError:
      type: object
      properties:
        message:
          type: string
          example: Validation failed
        error:
          type: string
          description: Validation error details

paths:
  # Auth endpoints
  /auth/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticate user and return JWT token
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/logout:
    post:
      tags:
        - Authentication
      summary: User logout
      description: Logout user and clear authentication cookie
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'

  /auth/register:
    post:
      tags:
        - Authentication
      summary: User registration
      description: Register a new user
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

  # Villager endpoints
  /villagers:
    post:
      tags:
        - Villagers
      summary: Add new villager
      description: Create a new villager record
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddVillagerRequest'
      responses:
        '201':
          description: Villager created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

    get:
      tags:
        - Villagers
      summary: Get all villagers
      description: Retrieve list of all villagers
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Page number
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
          description: Items per page
      responses:
        '200':
          description: Villagers retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /villagers/{nik}:
    get:
      tags:
        - Villagers
      summary: Get villager by NIK
      description: Retrieve specific villager information
      parameters:
        - name: nik
          in: path
          required: true
          schema:
            type: string
            pattern: '^[0-9]{16}$'
          description: 16-digit NIK
      responses:
        '200':
          description: Villager found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: Villager not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - Villagers
      summary: Update villager
      description: Update villager information
      parameters:
        - name: nik
          in: path
          required: true
          schema:
            type: string
            pattern: '^[0-9]{16}$'
          description: 16-digit NIK
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateVillagerRequest'
      responses:
        '200':
          description: Villager updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '404':
          description: Villager not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Villagers
      summary: Delete villager
      description: Delete villager record
      parameters:
        - name: nik
          in: path
          required: true
          schema:
            type: string
            pattern: '^[0-9]{16}$'
          description: 16-digit NIK
      responses:
        '200':
          description: Villager deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: Villager not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /villagers/family/{familyCardID}:
    get:
      tags:
        - Villagers
      summary: Get family members
      description: Retrieve all family members by family card ID
      parameters:
        - name: familyCardID
          in: path
          required: true
          schema:
            type: string
          description: Family card ID
      responses:
        '200':
          description: Family members retrieved
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/GetAllFamilyMember'

  # Family Card endpoints
  /family-cards:
    post:
      tags:
        - Family Cards
      summary: Add new family card
      description: Create a new family card record
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddFamilyCardRequest'
      responses:
        '201':
          description: Family card created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

    get:
      tags:
        - Family Cards
      summary: Get all family cards
      description: Retrieve list of all family cards
      responses:
        '200':
          description: Family cards retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/GetAllFamilyCardsResponse'

  /family-cards/{nik}:
    get:
      tags:
        - Family Cards
      summary: Get family card by NIK
      description: Retrieve family card information by NIK
      parameters:
        - name: nik
          in: path
          required: true
          schema:
            type: string
            pattern: '^[0-9]{16}$'
          description: Family card NIK
      responses:
        '200':
          description: Family card found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          description: Family card not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Village endpoints
  /villages:
    post:
      tags:
        - Villages
      summary: Create village
      description: Add a new village
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddVillageRequest'
      responses:
        '201':
          description: Village created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

    get:
      tags:
        - Villages
      summary: Get all villages
      description: Retrieve list of all villages
      responses:
        '200':
          description: Villages retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  # Sub-dimension endpoints
  /sub-dimensions/pendidikan:
    post:
      tags:
        - Sub Dimensions
      summary: Add education sub-dimension data
      description: Create education sub-dimension record
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddSubDimensionPendidikanRequest'
      responses:
        '201':
          description: Education data created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

tags:
  - name: Authentication
    description: User authentication and registration
  - name: Villagers
    description: Villager management endpoints
  - name: Family Cards
    description: Family card management endpoints
  - name: Villages
    description: Village management endpoints
  - name: Sub Dimensions
    description: Village development sub-dimension data management

externalDocs:
  description: Find more info about Indonesian Village Management
  url: https://github.com/mfachrizalg/Apps-I_Desa_Backend